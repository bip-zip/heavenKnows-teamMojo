{% extends 'base.html' %}
{% load static %}

{% block title %}Local to Global{% endblock title %}

{% block styles %}
<style>
    .accordion-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
    }
    
    .accordion-content.active {
        max-height: 500px;
        transition: max-height 0.5s ease-in;
    }
    
    .business-card {
        transition: all 0.3s ease;
    }
    
    .business-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
</style>
{% endblock styles %}

{% block content %}
<!-- Hero Section -->
<section class="relative bg-gradient-to-br from-green-500 via-emerald-600 to-teal-700 animate-gradient text-white py-20">
    <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-4xl md:text-6xl font-bold mb-4">
                Local to Global
            </h1>
            <p class="text-xl md:text-2xl mb-16 text-green-50">
                Discover authentic Nepali businesses - handcrafted products
            </p>
           
        </div>
    </div>
    
    <!-- Decorative wave -->
    <div class="absolute bottom-0 left-0 right-0">
        <svg viewBox="0 0 1440 120" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M0 120L60 105C120 90 240 60 360 45C480 30 600 30 720 37.5C840 45 960 60 1080 67.5C1200 75 1320 75 1380 75L1440 75V120H1380C1320 120 1200 120 1080 120C960 120 840 120 720 120C600 120 480 120 360 120C240 120 120 120 60 120H0Z" fill="white"/>
        </svg>
    </div>
</section>

<!-- Search and Filter Section -->
<section class="py-8 bg-gray-50">
    <div class="container mx-auto px-4">
        <form method="get" class="max-w-4xl mx-auto">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Search Input -->
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-search mr-2 text-green-600"></i>Search
                        </label>
                        <input 
                            type="text" 
                            name="search" 
                            value="{{ search_query }}"
                            placeholder="Search manufacturers, products, locations..." 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                        >
                    </div>
                    
                    <!-- District Filter -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-map-marker-alt mr-2 text-green-600"></i>District
                        </label>
                        <select 
                            name="district" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                        >
                            <option value="">All Districts</option>
                            {% for dist in districts %}
                                <option value="{{ dist }}" {% if selected_district == dist %}selected{% endif %}>
                                    {{ dist }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <div class="flex gap-3 mt-4">
                    <button 
                        type="submit" 
                        class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-300"
                    >
                        <i class="fas fa-filter mr-2"></i>Apply Filters
                    </button>
                    <a 
                        href="{% url 'businesses:local_to_global' %}" 
                        class="px-6 py-3 border-2 border-gray-300 hover:border-gray-400 text-gray-700 font-semibold rounded-lg transition duration-300"
                    >
                        <i class="fas fa-redo mr-2"></i>Reset
                    </a>
                </div>
            </div>
        </form>
    </div>
</section>

<!-- Results Count -->
<section class="py-4 bg-white border-b">
    <div class="container mx-auto px-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <p class="text-gray-600">
                <span class="font-semibold text-gray-800">{{ page_obj.paginator.count }}</span> manufacturers found
            </p>
            {% if search_query or selected_district %}
                <div class="flex flex-wrap gap-2">
                    {% if search_query %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800">
                            Search: "{{ search_query }}"
                        </span>
                    {% endif %}
                    {% if selected_district %}
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-purple-100 text-purple-800">
                            {{ selected_district }}
                        </span>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
</section>

<!-- Business Listings -->
<section class="py-12 bg-gray-50">
    <div class="container mx-auto px-4">
        <div class="max-w-7xl mx-auto">
            {% if businesses %}
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for business in businesses %}
                        <div class="business-card bg-white rounded-xl shadow-md overflow-hidden">
                            <!-- Business Image -->
                            <div class="relative h-48 bg-gradient-to-br from-green-400 to-blue-500 overflow-hidden">
                                {% if business.images.first %}
                                    <img 
                                        src="{{ business.images.first.image.url }}" 
                                        alt="{{ business.business_name }}"
                                        class="w-full h-full object-cover"
                                    >
                                {% else %}
                                    <div class="w-full h-full flex items-center justify-center">
                                        <i class="fas fa-industry text-white text-6xl opacity-50"></i>
                                    </div>
                                {% endif %}
                                
                                <!-- Verification Badge -->
                                {% if business.is_verified %}
                                    <div class="absolute top-4 left-4">
                                        <span class="px-2 py-1 bg-green-500 text-white rounded-full text-xs font-semibold">
                                            <i class="fas fa-check-circle mr-1"></i>Verified
                                        </span>
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Business Info -->
                            <div class="p-5">
                                <h3 class="text-xl font-bold text-gray-800 mb-2">
                                    {{ business.business_name }}
                                </h3>
                                
                                <div class="flex items-center text-sm text-gray-600 mb-3">
                                    <i class="fas fa-map-marker-alt text-green-600 mr-2"></i>
                                    <span>{{ business.district }}, {{ business.province }}</span>
                                </div>
                                
                                {% if business.description %}
                                    <p class="text-gray-600 text-sm mb-4 line-clamp-2">
                                        {{ business.description|truncatewords:20 }}
                                    </p>
                                {% endif %}
                                
                                <!-- Accordion Toggle Button -->
                                <button 
                                    onclick="toggleAccordion('business-{{ business.id }}')"
                                    class="w-full text-green-600 hover:text-green-700 font-semibold text-sm py-2 border-t border-gray-200 flex items-center justify-center transition duration-300"
                                >
                                    <span class="accordion-text">View Details</span>
                                    <i class="fas fa-chevron-down ml-2 accordion-icon transition-transform duration-300"></i>
                                </button>
                            </div>
                            
                            <!-- Accordion Content -->
                            <div id="business-{{ business.id }}" class="accordion-content border-t border-gray-100">
                                <div class="p-5 bg-gray-50 space-y-3">
                                    <!-- Contact Info -->
                                    <div class="flex items-start">
                                        <i class="fas fa-phone text-green-600 mt-1 mr-3"></i>
                                        <div>
                                            <p class="text-xs text-gray-500 uppercase">Phone</p>
                                            <p class="text-sm font-semibold text-gray-800">{{ business.phone }}</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Email -->
                                    <div class="flex items-start">
                                        <i class="fas fa-envelope text-green-600 mt-1 mr-3"></i>
                                        <div>
                                            <p class="text-xs text-gray-500 uppercase">Email</p>
                                            <p class="text-sm font-semibold text-gray-800">{{ business.user.email }}</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Address -->
                                    <div class="flex items-start">
                                        <i class="fas fa-location-dot text-green-600 mt-1 mr-3"></i>
                                        <div>
                                            <p class="text-xs text-gray-500 uppercase">Address</p>
                                            <p class="text-sm text-gray-800">{{ business.address }}</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Website -->
                                    {% if business.website %}
                                        <div class="flex items-start">
                                            <i class="fas fa-globe text-green-600 mt-1 mr-3"></i>
                                            <div>
                                                <p class="text-xs text-gray-500 uppercase">Website</p>
                                                <a href="{{ business.website }}" target="_blank" class="text-sm text-blue-600 hover:text-blue-800 underline">
                                                    Visit Website
                                                </a>
                                            </div>
                                        </div>
                                    {% endif %}
                                    
                                    <!-- Manufacturer Details -->
                                    {% if business.manufacturer_details %}
                                        <div class="pt-3 border-t border-gray-200">
                                            <h4 class="text-sm font-semibold text-gray-700 mb-2">Product Information</h4>
                                            <p class="text-xs text-gray-500 uppercase mb-1">Category</p>
                                            <p class="text-sm font-semibold mb-2">{{ business.manufacturer_details.get_product_category_display }}</p>
                                            <p class="text-xs text-gray-600">{{ business.manufacturer_details.product_description }}</p>
                                            
                                            {% if business.manufacturer_details.minimum_order_quantity %}
                                                <div class="mt-2">
                                                    <p class="text-xs text-gray-500 uppercase">Minimum Order</p>
                                                    <p class="text-sm font-semibold">{{ business.manufacturer_details.minimum_order_quantity }} units</p>
                                                </div>
                                            {% endif %}
                                            
                                            {% if business.manufacturer_details.ships_internationally %}
                                                <div class="mt-2">
                                                    <span class="inline-flex items-center px-2 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded">
                                                        <i class="fas fa-globe mr-1"></i>Ships Internationally
                                                    </span>
                                                </div>
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                <!-- Pagination -->
                {% if is_paginated %}
                    <div class="mt-12 flex justify-center">
                        <nav class="flex items-center space-x-2">
                            {% if page_obj.has_previous %}
                                <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_district %}&district={{ selected_district }}{% endif %}" 
                                   class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition duration-300">
                                    First
                                </a>
                                <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_district %}&district={{ selected_district }}{% endif %}" 
                                   class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition duration-300">
                                    <i class="fas fa-chevron-left"></i>
                                </a>
                            {% endif %}
                            
                            <span class="px-4 py-2 bg-green-600 text-white rounded-lg font-semibold">
                                {{ page_obj.number }}
                            </span>
                            
                            {% if page_obj.has_next %}
                                <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_district %}&district={{ selected_district }}{% endif %}" 
                                   class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition duration-300">
                                    <i class="fas fa-chevron-right"></i>
                                </a>
                                <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if selected_district %}&district={{ selected_district }}{% endif %}" 
                                   class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition duration-300">
                                    Last
                                </a>
                            {% endif %}
                        </nav>
                    </div>
                {% endif %}
                
            {% else %}
                <!-- Empty State -->
                <div class="text-center py-16">
                    <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gray-100 mb-6">
                        <i class="fas fa-search text-gray-400 text-3xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">No manufacturers found</h3>
                    <p class="text-gray-600 mb-6">Try adjusting your search or filters</p>
                    <a href="{% url 'businesses:local_to_global' %}" 
                       class="inline-flex items-center px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition duration-300">
                        <i class="fas fa-redo mr-2"></i>Clear Filters
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</section>
{% endblock content %}

{% block scripts %}
<script>
    function toggleAccordion(id) {
        const content = document.getElementById(id);
        const button = content.previousElementSibling.querySelector('button');
        const icon = button.querySelector('.accordion-icon');
        const text = button.querySelector('.accordion-text');
        
        // Toggle active class
        content.classList.toggle('active');
        
        // Rotate icon
        if (content.classList.contains('active')) {
            icon.style.transform = 'rotate(180deg)';
            text.textContent = 'Hide Details';
        } else {
            icon.style.transform = 'rotate(0deg)';
            text.textContent = 'View Details';
        }
    }
    
    // Close all accordions when clicking outside
    document.addEventListener('click', function(event) {
        if (!event.target.closest('.business-card')) {
            document.querySelectorAll('.accordion-content.active').forEach(content => {
                const button = content.previousElementSibling.querySelector('button');
                const icon = button.querySelector('.accordion-icon');
                const text = button.querySelector('.accordion-text');
                
                content.classList.remove('active');
                icon.style.transform = 'rotate(0deg)';
                text.textContent = 'View Details';
            });
        }
    });
</script>
{% endblock scripts %}